
# 图像目录处理节点说明

## 节点功能概述

#### 1. 图像目录加载器节点 (`ImageDirectoryLoader`)
- **功能**：从指定目录批量加载图片，支持递归搜索子目录、多种排序方式（按名称、按数字、按修改时间）、文件扩展名过滤等功能。支持单张顺序加载模式和记忆功能，可实现断点续传和智能队列管理。新增自动索引每次运行按顺序加载路径照片配合队列数量批量运行>>
- **输入参数**：
  - `目录路径`：要加载的图像目录路径。
  - `起始索引`：从第几张图片开始加载。
  - `单张顺序加载`：启用后每次仅加载一张图片，通过队列运行数量控制批量处理。
  - `启用记忆功能`：启用后记住最后加载位置，支持断点续传。
  - `任务批次编号`：任务批次标识，变化时重置打开时的记忆功能以及重置自动索引的编号。路径变化时也会重置。
  - `智能队列建议`：启用后会在控制台显示剩余图片数量和建议的队列次数。
  - `sort_method`：图片排序方式。
  - `递归搜索子目录`：是否递归查找所有子文件夹。
  - `文件扩展名过滤`：用逗号分隔的文件扩展名列表，留空则加载所有支持的图片格式。默认包含jpg,jpeg,png,bmp,webp,tiff 6种comfyui常用格式，有额外格式需求可以自己手动添加。
  - `加载失败跳过`：加载失败时是否跳过。遇到格式不正确、损坏无法加载的图片，最好勾选以免卡壳。
  - `转换为RGBA`：打开会转换为带有透明通道的PNG图片。
 
- **输出参数**：
  - `图像`：加载的图像张量。
  - `相对路径`：图像的相对路径列表。
  - `filename_text`：文件名文本。
  - `可用总数`：可用的图像总数。（可单独当计数器使用，经测试检测目录下4000个子文件里的18万张照片仅需40秒）单独计数时后需要修改批次号重置自动索引编号或记忆位置。
  - `剩余未处理`：剩余未处理的图片数量，用于智能队列管理。

**使用建议**：
- 单张顺序加载 + 队列运行数量：推荐的批量处理方式，可精确控制处理数量。
- 智能队列建议：帮助了解剩余图片数量，避免重复执行多余的循环。
- 记忆功能：适合大批量处理时的断点续传。

#### 2. 图像目录保存器节点 (`ImageDirectorySaver`)
- **功能**：将图像批量保存到指定目录，保持原始相对路径结构。支持覆盖已存在文件、选择保存格式。
- **输入参数**：
  - `图像批量`：要保存的图像张量批量。
  - `相对路径列表`：图像的相对路径列表。
  - `输出目录`：保存图像的目录。不填写则默认保存在comfyui\output文件夹。
  - `覆盖已存在文件`：是否覆盖已存在的文件。这里选否会跳过同名文件。
  - `保存格式`：（原格式、jpg、png、webp）以及设置JPG和WEBP格式的压缩质量。
 
#### 3. 图像保存与预览节点 (`ImageSaveWithPreview`)
- **功能**：保存单张图像到指定路径并提供预览功能，支持连接加载图像节点的文件名。可处理保存路径、文件名和扩展名，自动生成唯一文件名，支持覆盖已存在文件和选择保存格式。
- **输入参数**：
  - `图像`：要保存的图像张量。
  - `保存路径`：保存图像的目录。不填写则默认保存在comfyui\output文件夹。
  - `覆盖已存在文件`：是否覆盖已存在的文件。这里选否会重命名添加序号另存。
  - `保存格式`：保存图像的格式。（原格式、jpg、png、webp）
  - `压缩质量`：仅适用于jpg和webp格式的压缩质量。
  - `filename_text`：从加载图像节点传递文件名，不连接则可以手动输入文件名（但也需要每次手动变更否则会覆盖），留空则自动生成默认文件名。
- **输出参数**：
  - `预览图像`：预览的图像张量。
  - `保存路径`：图像保存的路径。

## 更新日志
- 移除了"最大加载数量"参数，现在通过单张顺序加载 + 队列运行数量实现更灵活的批量控制。
- 新增"剩余未处理"输出参数，提供剩余图片数量信息。
- 新增"智能队列建议"功能，在控制台显示处理建议，避免重复执行。
